{% extends "base.html" %}
{% block title %}{{ resource.name }} ({{resource.kind}}{% if namespace: %} in {{namespace}}{% endif %}){% endblock %}
{% block content %}
<nav class="breadcrumb" aria-label="breadcrumbs">
  <ul>
      <li><a href="/clusters/{{ cluster }}">{{ cluster }}</a></li>
      {% if namespace and resource.kind != 'Namespace': %}
        <li><a href="/clusters/{{ cluster }}/namespaces/{{ namespace }}">{{ namespace }}</a></li>
        <li><a href="/clusters/{{ cluster }}/namespaces/{{ namespace }}/{{ resource.endpoint }}">{{ resource.endpoint }}</a></li>
      {% else: %}
        <li><a href="/clusters/{{ cluster }}/{{ resource.endpoint }}">{{ resource.endpoint }}</a></li>
      {% endif %}
      <li class="is-active"><a href="#">{{ resource.name }}</a></li>
  </ul>
</nav>

<h2 class="title">{{ resource.name }}</h2>
<div class="tabs is-small">
  <ul>
      <li {% if view != 'yaml': %} class="is-active" {% endif %}><a href="?">Default</a></li>
      <li {% if view == 'yaml': %} class="is-active" {% endif %}><a href="?view=yaml">YAML</a></li>
      {% if resource.kind in ('Pod', 'Deployment', 'ReplicaSet', 'DaemonSet', 'StatefulSet'): %}
      <li><a href="/clusters/{{ cluster }}/namespaces/{{ resource.metadata.namespace }}/{{ resource.endpoint }}/{{ resource.name }}/logs">Logs</a></li>
      {% endif %}
  </ul>
</div>

{% if view == 'yaml': %}
<div>
{{ resource.obj|yaml|highlight(linenos=True)|safe }}
</div>
{% else: %}
<div>
    <div>
    {% for key, val in resource.labels.items()|sort: %}
      {% if namespace: %}
    <a href="/clusters/{{ cluster }}/namespaces/{{ namespace }}/{{ resource.endpoint }}?selector={{key}}={{val}}"><span class="tag is-link">{{ key }}: {{ val }}</span></a>
    {% else: %}
    <a href="/clusters/{{ cluster }}/{{ resource.endpoint }}?selector={{key}}={{val}}"><span class="tag is-link">{{ key }}: {{ val }}</span></a>
    {% endif %}
    {% endfor %}
    </div>
    <div>
    {% for key, val in resource.annotations.items()|sort: %}
    <span class="tag">{{ key }}: {{ val|truncate(40) }}</span>
    {% endfor %}
    </div>

    {% for key, val in resource.obj.items()|sort: %}
    {% if key not in ('metadata', 'apiVersion', 'kind'): %}
    <div class="card">
  <header class="card-header">
    <p class="card-header-title">
    {{ key }}
    </p>
  </header>
  <div class="card-content">
    <div class="content">
    {{ val|yaml|highlight|safe }}
    </div>
    </div>
    </div>
    {% endif %}
    {% endfor %}

    {% if resource.kind == "Namespace": %}
    <a href="/clusters/{{ cluster }}/namespaces/{{ namespace }}/_resource-types">Resource Types</a>
    {% endif %}

</div>
{% endif %}

{% if table: %}
<h4 class="title is-4">Managed Pods</h4>
<table class="table is-striped">
    <tr>
        {% for column in table.columns: %}
        <th title="{{ column.description }}"><a href="{{ rel_url.update_query(sort=column.name) }}">{{ column.name }}</a></th>
        {% endfor %}
        <th><a href="{{ rel_url.update_query(sort='Created') }}">Created</th>
    </tr>
{% for row in table.rows: %}
<tr>
    {% if is_all_namespaces: %}
    <td><a href="/clusters/{{ table.obj.cluster.name }}/namespaces/{{ row.object.metadata.namespace }}">{{ row.object.metadata.namespace }}</a></td>
    {% endif %}
    {% for cell in row.cells: %}
    {% if loop.first: %}
    {% if row.object.metadata.namespace: %}
    <td><a href="/clusters/{{ table.obj.cluster.name }}/namespaces/{{ row.object.metadata.namespace }}/{{ table.api_obj_class.endpoint }}/{{ row.object.metadata.name }}">{{ cell }}</a></td>
      {% else: %}
    <td><a href="/clusters/{{ table.obj.cluster.name }}/{{ table.api_obj_class.endpoint }}/{{ row.object.metadata.name }}">{{ cell }}</a></td>
      {% endif %}
    {% else: %}
    <td class="{{ get_cell_class(table, loop.index0, cell) }}">{{ cell if cell is not none}}</td>
    {% endif %}
    {% endfor %}
    <td>{{ row.object.metadata.creationTimestamp }}</td>
</tr>
{% else: %}
<tr>
    <td colspan="{{ table.columns|length + 1 }}">No {{ table.api_obj_class.kind }} objects {% if namespace and not is_all_namespaces:%} in namespace "{{ namespace }}"{% endif %} found.</td>
</tr>
{% endfor %}
</table>{% endif %}

<h4 class="title is-4">Events</h4>
<table class="table is-striped">
    <tr>
        <th>Type</th>
        <th>Reason</th>
        <th>Age</th>
        <th>From</th>
        <th>Message</th>
    </tr>
{% for event in events: %}
<tr>
    <td>{{ event.obj.type }}</td>
    <td>{{ event.obj.reason }}</td>
    <td>{{ event.obj.lastTimestamp }}</td>
    <td>{{ event.obj.source.component }}</td>
    <td>{{ event.obj.message }}</td>
</tr>
{% else: %}
<tr>
    <td colspan="5">No events found.</td>
</tr>
{% endfor %}
</table>
{% endblock %}
